<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>WittyShare: Wittyshare Documentation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">WittyShare
   &#160;<span id="projectnumber">0.2</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Wittyshare Documentation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>Wittyshare</h1>
<h2>Presentation</h2>
<p>Wittyshare is a CMS written in C++ using the WT library. It's main characteristic is that it is only based on the filesystem. No database are required to run the application. It has also a powerful user rights management and can be easily extended using modules.</p>
<h2>The core of the application</h2>
<h3>The FileSystemTree</h3>
<p>The core of wittyshare is the <a class="el" href="classWsFileSystemTree.html" title="Represents the file structure on disk. ">WsFileSystemTree</a>. This tree represents the files hierarchy on disk. When the application starts, it will scan all the directories starting from [root_path] and builds the tree. It will also search for config files for each directory and parse them. The main advantage of this solution is the speed. The FsTree will be stored in memory for fast access. This tree does not takes permissions in account because it does not represent any user, it will only be used to generate other trees.</p>
<p>It uses the <a class="el" href="classWsDirectoryCrawler.html" title="Abstract class used to crawl a directory. ">WsDirectoryCrawler</a> class to crawl over the directories. The <a class="el" href="classWsFileSystemTree.html" title="Represents the file structure on disk. ">WsFileSystemTree</a> inherits form the <a class="el" href="classWsDirectoryCrawler.html" title="Abstract class used to crawl a directory. ">WsDirectoryCrawler</a> and each time a dir is found, it calls the virtual method <a class="el" href="classWsFileSystemTree.html#a23a17c87d29829c4ca684b5c08b7ce67" title="this method is called by browse when the boost::filesystem::path is a folder ">WsFileSystemTree::applyDirectory()</a> which is overriden in <a class="el" href="classWsFileSystemTree.html" title="Represents the file structure on disk. ">WsFileSystemTree</a> class. This method creates a new Node and adds it to the current node and the current node is set to this node. The same is done for <a class="el" href="classWsFileSystemTree.html#aaa17d6e70043492d57dacd565b921166" title="this method is called by browse when the boost::filesystem::path is a file ">WsFileSystemTree::applyFile()</a>, but the current node is not changed.(we dont crawl deeper because it's a file). When all the subdirs of a directory are crawled, the <a class="el" href="classWsDirectoryCrawler.html" title="Abstract class used to crawl a directory. ">WsDirectoryCrawler</a> class calls the <a class="el" href="classWsFileSystemTree.html#ab7af76723ce2c2557f8e4303b39a0b4c" title="this method is called when finished browsing the subdir ">WsFileSystemTree::endChild()</a> method to notify the subclass so it can set the current node to the current.parent()</p>
<p>Each node has an properties (<a class="el" href="classWsNodeProperties.html" title="Properties of a WsNode. ">WsNodeProperties</a>) object attached by the <a class="el" href="classWsFileSystemTree.html" title="Represents the file structure on disk. ">WsFileSystemTree</a> that contains the properties of the node. The properties are parsed from the $NODE_PATH/.config/properties.json for the directories or $NODE_PATH/.config/nodes/$FILENAME.json for the nodes. It is not mandatory for a node to have a config file. The access rights for a node can also depend from the parent (see the inherit_rights_from_parent property). Each node also has the method isAllowed taking a list of groups that will return true if at least one of the groups has access. The FileNode checks access against its containing directory. The DirNode checks if it has a properties object setting groups. If yes, it checks against these groups. It not, it does up to the parent and goes through the same procedure.</p>
<p>Each node has an properties object attached by the <a class="el" href="classWsFileSystemTree.html" title="Represents the file structure on disk. ">WsFileSystemTree</a>. Each <a class="el" href="classWsNode.html" title="Represents a node on disk. ">WsNode</a> also has the method isAllowed taking a list of groups that will return true if at least one of the groups has access. The <a class="el" href="classWsFileNode.html" title="Reprensents a File on disk. ">WsFileNode</a> checks access against its containing directory. The DirNode checks if it has a properties object setting groups. If yes, it checks against these groups. It not, it does up to the parent and goes through the same procedure is the inherit_from_parent is ste to true in the configuration of the node or in the WsGlobalConfiguration.</p>
<h3>The MenuTree</h3>
<p>The <a class="el" href="classWsMenuTree.html" title="Reprensents a MenuTree. ">WsMenuTree</a> is used to build the menu of the application. The MenuTree is created from the <a class="el" href="classWsFileSystemTree.html" title="Represents the file structure on disk. ">WsFileSystemTree</a> tree by crawling over it and applying the following rules:</p>
<ul>
<li>If the user does not have access to the node</li>
<li>If the Node property [in_menu] is set to false</li>
<li>If the Node property [in_parent] is set to false<ul>
<li>skip the node and all children of the node,</li>
</ul>
</li>
<li>If the [max_menu_depth] is reached<ul>
<li>End crawling and return the MenuTree</li>
</ul>
</li>
</ul>
<p>The <a class="el" href="classWsMenuTree.html" title="Reprensents a MenuTree. ">WsMenuTree</a> class inherit from <a class="el" href="classWsAbstractTree.html" title="Abstract class representing an WsAccessTree or WsMenuTree. ">WsAbstractTree</a>, builds the menu of a user based on a the <a class="el" href="classWsFileSystemTree.html" title="Represents the file structure on disk. ">WsFileSystemTree</a> representing all the files on the server and a set of gids, which are the names of the groups where the user belongs.</p>
<p>The <a class="el" href="classWsAbstractTree.html" title="Abstract class representing an WsAccessTree or WsMenuTree. ">WsAbstractTree</a> class inherits from the <a class="el" href="classWsTreeTraversal.html" title="Used to traverse the tree. ">WsTreeTraversal</a> class that runs through the <a class="el" href="classWsFileSystemTree.html" title="Represents the file structure on disk. ">WsFileSystemTree</a> and, for each <a class="el" href="classWsNode.html" title="Represents a node on disk. ">WsNode</a> found, it calls a virtual function overridden in the child class. The <a class="el" href="classWsAbstractTree.html" title="Abstract class representing an WsAccessTree or WsMenuTree. ">WsAbstractTree</a> class tests for each Node if the user is allowed to access it or no. If the user is allowed, a new Node is created whith the same Properties, but without any children. The new Node is added to the MenuTree. If the user does not have access, the Node and all its children are skipped.</p>
<p>The <a class="el" href="classWsAbstractTree.html" title="Abstract class representing an WsAccessTree or WsMenuTree. ">WsAbstractTree</a> class contains 3 overriden functions of the parent class which are:</p>
<ul>
<li><a class="el" href="classWsAbstractTree.html#abdbf1a3fb31ae269faad707560503740" title="Called when a directory is being traversed. ">WsAbstractTree::beginTraverseDir</a></li>
<li><a class="el" href="classWsAbstractTree.html#a55dd0368c14cb8c7170d8baf7b83fecb" title="Called when traversing a fileNode. ">WsAbstractTree::traverseFile</a></li>
</ul>
<p><a class="el" href="classWsAbstractTree.html#abdbf1a3fb31ae269faad707560503740" title="Called when a directory is being traversed. ">WsAbstractTree::beginTraverseDir</a> is called by the <a class="el" href="classWsTreeTraversal.html" title="Used to traverse the tree. ">WsTreeTraversal</a> each time a <a class="el" href="classWsDirNode.html" title="Reprensents a Directory on disk. ">WsDirNode</a> is found. It Creates the new Node with the properties, connects the current Node to this new Node and sets the new Node as the current Node.</p>
<p><a class="el" href="classWsAbstractTree.html#a5d046f3b670c3f47467d17d3ee20ba06" title="Called when a directory has been completely traversed. ie all subnodes(recursively all sub nodes of s...">WsAbstractTree::endTraverseDir</a> is called by the <a class="el" href="classWsTreeTraversal.html" title="Used to traverse the tree. ">WsTreeTraversal</a> each time the <a class="el" href="classWsTreeTraversal.html" title="Used to traverse the tree. ">WsTreeTraversal</a> finish to browse a <a class="el" href="classWsDirNode.html" title="Reprensents a Directory on disk. ">WsDirNode</a> and all its children. It sets the current Node as the Parent of the current Node.</p>
<p><a class="el" href="classWsAbstractTree.html#a55dd0368c14cb8c7170d8baf7b83fecb" title="Called when traversing a fileNode. ">WsAbstractTree::traverseFile</a> is called by the <a class="el" href="classWsTreeTraversal.html" title="Used to traverse the tree. ">WsTreeTraversal</a> each time a <a class="el" href="classWsFileNode.html" title="Reprensents a File on disk. ">WsFileNode</a> is found. it does the same things as <a class="el" href="classWsAbstractTree.html#abdbf1a3fb31ae269faad707560503740" title="Called when a directory is being traversed. ">WsAbstractTree::beginTraverseDir</a> but creates a <a class="el" href="classWsFileNode.html" title="Reprensents a File on disk. ">WsFileNode</a> instead of a <a class="el" href="classWsDirNode.html" title="Reprensents a Directory on disk. ">WsDirNode</a>. The current Node is not changed.</p>
<p>Requests to the WsFilesystemtree are sent thanks to an <a class="el" href="classWsAbstractFsClient.html" title="Abstract Interface between the WsUser class and the operation on the tree. ">WsAbstractFsClient</a> that allows multiple implementations (at time of writing: daemon and in object directly)</p>
<h3>The AccessTree</h3>
<p>The <a class="el" href="classWsAccessTree.html" title="Reprensents an access tree. ">WsAccessTree</a> is the same as the <a class="el" href="classWsMenuTree.html" title="Reprensents a MenuTree. ">WsMenuTree</a> but does not take in consideration the [in_menu], [in_parent], [max_menu_depth] properties.</p>
<h2>Nodes</h2>
<p>There are 2 kind of nodes: The <a class="el" href="classWsFileNode.html" title="Reprensents a File on disk. ">WsFileNode</a> that represents a file and the <a class="el" href="classWsDirNode.html" title="Reprensents a Directory on disk. ">WsDirNode</a> that represents a directory. The <a class="el" href="classWsFileNode.html" title="Reprensents a File on disk. ">WsFileNode</a> has the following properties:</p>
<ul>
<li>FileSize (in <a class="el" href="classWsFileNode.html" title="Reprensents a File on disk. ">WsFileNode</a>)</li>
<li>Modification date (in <a class="el" href="classWsFileNode.html" title="Reprensents a File on disk. ">WsFileNode</a>)</li>
<li>Creation date (not implemented) (in <a class="el" href="classWsFileNode.html" title="Reprensents a File on disk. ">WsFileNode</a>)</li>
<li>publish_date (in properties)</li>
<li>author (in properties</li>
<li>short_desc (in properties)</li>
<li>in_menu : item is displayes or not in the menu</li>
<li>in_view : item is displayes or not in the view (SiteMap, ...)</li>
<li>FS properties<ul>
<li>FileSize (in <a class="el" href="classWsFileNode.html" title="Reprensents a File on disk. ">WsFileNode</a>)</li>
<li>Modification date (in <a class="el" href="classWsFileNode.html" title="Reprensents a File on disk. ">WsFileNode</a>)</li>
<li>Creation date (not implemented) (in <a class="el" href="classWsFileNode.html" title="Reprensents a File on disk. ">WsFileNode</a>)</li>
</ul>
</li>
<li>.config Properties<ul>
<li>publish_date (in <a class="el" href="classWsNodeProperties.html" title="Properties of a WsNode. ">WsNodeProperties</a>) default time(now)</li>
<li>author (in <a class="el" href="classWsNodeProperties.html" title="Properties of a WsNode. ">WsNodeProperties</a>) default is the editor of the document</li>
<li>short_desc (in properties) default empty</li>
<li>in_menu : appears in menu or not, default false</li>
<li>in_view : appears in view or not, default true</li>
<li>sort_number: default -1</li>
<li>sort: sort files or no: default true</li>
</ul>
</li>
</ul>
<p>The <a class="el" href="classWsDirNode.html" title="Reprensents a Directory on disk. ">WsDirNode</a> has the following properties:</p>
<ul>
<li>in_parent: is the list of files in the directories displayed when we display the directory?<ul>
<li>not inherited from parent directory</li>
<li>default: true</li>
</ul>
</li>
<li>in_menu: is the directory displayed in the menu? Beware, if the parent has in_menu=false, and in the subdirectory you set in_menu=true, it will have no effect! -in_view<ul>
<li>not inherited from parent directory</li>
<li>value: true or false</li>
<li>default: false</li>
</ul>
</li>
<li>groups: user groups that have access to this directory. "Guest" is the group used for publicly accessible directories.<ul>
<li>not inherited from parent directory</li>
<li>value: list of group names</li>
<li>default: empty</li>
</ul>
</li>
<li>sort_criteria: criteria by which to order the children in this directory<ul>
<li>not inherited</li>
<li>value: name, publish_date, size</li>
<li>default: name</li>
</ul>
</li>
<li>sort_order: order in which to display the children of this directory: asc/desc<ul>
<li>not inherited</li>
<li>value: asc or desc</li>
<li>default: asc</li>
</ul>
</li>
<li>inherit_from_parent : If set to true the current node will take its permissions from the parent. This is a recursive call. If the current node has groups defined, it will override the inherit_from_parent flag.</li>
</ul>
<h2>The configuration files</h2>
<p># There are 3 main configuration files (All values must be written between "" ):</p>
<ul>
<li>wittyshare_global.json<ul>
<li>"global" section<ul>
<li>"root_path" : Root path of site contents [STRING]</li>
<li>"enable_compression" : Enable or not compression between http server and fsdeamon (Used only when daemon is set to true [true/false]</li>
<li>"public_site" : Make site public or no (Give access to everyone to everything [true/false]</li>
<li>"home_page" : Home page location [STRING]</li>
<li>"monitoring": Use GAMIN to monitor site content [true/false]</li>
<li>"daemon" : Use FsDaemon or run in local [true/false]</li>
<li>"admin_group" : Administrator group name [STRING]</li>
<li>"editor_group" : Editor group name [STRING]</li>
<li>"refresh_delay" : if monitor = false, will refresh the tree every x sec. otherwise on each timout, it will check for modifications and update the tree if necessary if monitor = false, and x=0 the tree will never be updated [INT]</li>
<li>"max_menu_depth" : Max menu depth : 0 means no max depth [INT]</li>
<li>"inherit_rights_from_parent" : Inherit rights from the parent [true/false]</li>
<li>"log_level" : Log level : [debug/info/warn/error]</li>
<li>"log_path" : Log location : [STDOUT/STDERR/STRING]h</li>
<li>"dir_size" : If true the size of a dir will be the number of items in it (one level) [true/false]</li>
</ul>
</li>
<li>"ldap" section<ul>
<li>"ldap_search_base_uid" : LDAP search base uid [STRING]</li>
<li>"ldap_search_base_groups" : LDAP search base groups [STRING]</li>
<li>"ldap_server" : LDAP server [STRING]</li>
<li>"ldap_server_name" : LDAP server name [STRING]</li>
<li>"ldap_uid" : LDAP uid [STRING]</li>
<li>"ldap_sn_key" : LDAP sn key [STRING]</li>
<li>"ldap_gn_key" : LDAP givenName [STRING]</li>
<li>"ldap_mail_key" : LDAP mail key [STRING]</li>
<li>"ldap_groups_key" : LDAP groups key [STRING]</li>
<li>"ldap_filter_groups" : LDAP filter groups [STRING]</li>
<li>"ldap_filter_uid" : LDAP filter uid [STRING]</li>
</ul>
</li>
</ul>
</li>
<li>wittyshare_layout.json<ul>
<li>Contains the layout properties</li>
</ul>
</li>
<li>wittyshare_plugins.json<ul>
<li>Contains the plugins to load</li>
</ul>
</li>
</ul>
<h2>The update mechanism</h2>
<p>WittyShare uses Gamin to monitor the filesystem and this is implemented in <a class="el" href="classWsMonitor.html" title="Monitors the filesystem and call the WsFsTreeUpdater::update() method accordignly. ">WsMonitor</a> class. This option can be desactivated (See monitoring key in wittyshare_global.json). There are 2 threads that monitors the filesystem. The first one monitors all files except config files. The second one monitors only config dir. When a new file is created or deleted outside the .config folder, the update thread will wait for a timeout to expire (See refresh_delay in wittyshare_global.json) and will then update the tree. If a file is created, deleted, modified in the .config directory, the update thread will wait for the timeout and will rebuild the tree to take into account new config files. A lock can be set to avoid Directory scanning during a file/folder copy. To do that you only need to create a file named freezetree in the .config folder located in the root, before the file copy and remove it after. The update thread will look for this file before updating and will cancel update if the file is existing.</p>
<p>If the monitoring is disabled, the filesystemTree will not be updated when a file creation/deletion occurs. However the FileSystemTree will refresh everytime a timeout occurs (See refresh_delay in wittyshare_global.json). If this refresh delay is set to 0, the FileSystemTree will never refresh.</p>
<h2>The FsDaemon</h2>
<p>The FsDaemon is a separate application that listen incoming request. The FsDaemon handles all the requests a client can make on the FileSystem.</p>
<ul>
<li>MenuRequest : Request the MenuTree</li>
<li>MenuRequestEx: Request the MenuTree ignoring files matching specific name or extension passed in argument</li>
<li>AccessTreeRequest : Request the AccessTree</li>
<li>PermRequest : Request Permissions for a node</li>
<li>PropRequest: Request a property of a node</li>
<li>AllGroupsRequest : Request all the groups defined in the LDAP</li>
<li>PropsRequest : Request all the properties of a node</li>
<li>SearchRequest: Make a search with terms</li>
<li>ClearCache: Clear the cache of the user (called when user is disconnected)</li>
<li>IsAdminRequest: Is the user an admin ?</li>
<li>IsEditorRequest: Is the user an editor ?</li>
<li>SavePropertiesRequest : Save properties of a node on the disk</li>
<li>SavePropertyRequest : Save a property of a node on the disk</li>
<li>CreateNodeRequest : Create a node on the disk with config files and in the tree</li>
<li>RenameNodeRequest: Rename a node (on disk, in tree,..)</li>
<li>DeleteNodeRequest: Delete a node (on disk, in tree,..)</li>
<li>RootPathRequest : Request the root path</li>
<li>GetTreeVersion : Get the stamp of the last FileSystemTree that was created</li>
</ul>
<p>For each request the user must be authenticated first (an Auth Request should have been made before). Every request return a response that takes into account the rights of the user to access a node</p>
<p>The FsDaemon can be launched using different options: Usage :</p>
<ul>
<li>[-h | &ndash;host] value : connect on host</li>
<li>[-p | &ndash;port] value : connect on port</li>
<li>[&ndash;protocol] value : use protocol</li>
<li>[&ndash;daemonize] : run server in background</li>
<li>[&ndash;root] : Filesystem root path</li>
<li>[&ndash;help] : display this help message</li>
<li>[&ndash;pid] value : write PID in file</li>
</ul>
<h2>Modules</h2>
<p>Wittyshare is built with the idea of modules. Almost Everything is a module. A Module is a library respecting a Interface (<a class="el" href="classWsModule.html">WsModule</a>) for the modules that are loaded client side.</p>
<p>The FsDaemon also use modules for the search and authentication part to facilitate changes (for example switch from mnogosearch to another search library)</p>
<h3>Authentification Module</h3>
<p>The authentication module is used to authenticate the user and to load all the groups available. It must inherit the <a class="el" href="classWsAbstractAuth.html" title="Abstract class for authentification. ">WsAbstractAuth</a> class and implement the virtual methods.</p>
<p>Actually there is an LDAP module that is implemented to authenticate (<a class="el" href="classWsLdapAuth.html" title="Ldap authentication module. ">WsLdapAuth</a>) but the architecture allows switching from one module of authentication to another easily by chaging the name of the module in the global configuration (wittyshare-global.json) in auth_libname</p>
<h3>Search Module</h3>
<p>The Search module is used to search in the filesystem for keywords and returns a vector&lt;WsResultItem&gt;.</p>
<p>It must inherit the <a class="el" href="classWsAbstractSearch.html" title="Abstract class for search. ">WsAbstractSearch</a> class and implement all the virtual methods.</p>
<p>Actually there is an implementation that uses MnoGoSearch as search library. The search must take into account the user rights because these are not tested upstream.</p>
<p>The search module can be changed easily by changing search_libname in wittyshare-global.json</p>
<h3>Other Modules (Plugins)</h3>
<p>Other modules are modules loaded client side:</p>
<ul>
<li><a class="el" href="classWsModAnchor.html">WsModAnchor</a></li>
<li><a class="el" href="classWsModBanners.html">WsModBanners</a></li>
<li><a class="el" href="classWsModBreadCrumb.html">WsModBreadCrumb</a></li>
<li><a class="el" href="classWsModDirectoryView2.html">WsModDirectoryView2</a></li>
<li><a class="el" href="classWsModEditor.html">WsModEditor</a></li>
<li><a class="el" href="classWsModFileUpload.html">WsModFileUpload</a></li>
<li><a class="el" href="classWsModFollowUs.html">WsModFollowUs</a></li>
<li><a class="el" href="classWsModGalleria.html">WsModGalleria</a></li>
<li><a class="el" href="classWsModImages2.html">WsModImages2</a></li>
<li><a class="el" href="classWsModImagesGallery.html">WsModImagesGallery</a></li>
<li><a class="el" href="classWsModLatestNews2.html">WsModLatestNews2</a>: Display latest news in website. Uses WsModLatestNews which is not the first version, but a module to collecte the latest news from the site's content.</li>
<li><a class="el" href="classWsModLinksList.html">WsModLinksList</a></li>
<li><a class="el" href="classWsModMeetingView.html">WsModMeetingView</a></li>
<li><a class="el" href="classWsModMenu.html">WsModMenu</a></li>
<li><a class="el" href="classWsModMenuImages.html">WsModMenuImages</a></li>
<li><a class="el" href="classWsModNewsLetter.html">WsModNewsLetter</a></li>
<li><a class="el" href="classWsModOdf.html">WsModOdf</a></li>
<li><a class="el" href="classWsModPdf.html">WsModPdf</a></li>
<li><a class="el" href="classWsModRSS.html">WsModRSS</a></li>
<li><a class="el" href="classWsModTwitter.html">WsModTwitter</a></li>
<li><a class="el" href="classWsModVideo.html">WsModVideo</a></li>
<li><a class="el" href="classWsModZip.html">WsModZip</a></li>
</ul>
<h2>Architecture</h2>
<div class="image">
<img src="../../uptodate/arch.png"  alt="Architecture" style="width: 100%;"/>
</div>
<p>The Wittyshare architecture was built to allow the use of a separate daemon for managing the tree operations. This daemon can be turned off and the local version of the tree used instead</p>
<p>The <a class="el" href="classWsUser.html" title="Interface that provides differents methods for accessing the FsTree as well as other features...">WsUser</a> class is used as an interface between the user and the tree operations. The <a class="el" href="classWsUser.html" title="Interface that provides differents methods for accessing the FsTree as well as other features...">WsUser</a> class represents one user and in instanciated when a client connects. This class contains the main methods for accessing the tree. <a class="el" href="classWsUser.html" title="Interface that provides differents methods for accessing the FsTree as well as other features...">WsUser</a> contains an object <a class="el" href="classWsAbstractFsClient.html" title="Abstract Interface between the WsUser class and the operation on the tree. ">WsAbstractFsClient</a> that is an Abstract class that will be instanciated differently whether the <a class="el" href="classWsFsDaemon.html" title="Main class of the FsDaemon. ">WsFsDaemon</a> is used or not.</p>
<p>When the <a class="el" href="classWsFsDaemon.html" title="Main class of the FsDaemon. ">WsFsDaemon</a> is used (the daemon option is set to true), the <a class="el" href="classWsAbstractFsClient.html" title="Abstract Interface between the WsUser class and the operation on the tree. ">WsAbstractFsClient</a> will be instanciated as a <a class="el" href="classWsFsDaemonClient.html" title="Interface between the User class and the fsdaemon. ">WsFsDaemonClient</a> and a <a class="el" href="classWsFsTreeClient.html" title="Interface between WsUser class and local tree. ">WsFsTreeClient</a> if the daemon is not used.</p>
<p>However the use of the daemon is transparent to the user. Once the WsFsAbtractFsClient object is instanciated, the <a class="el" href="classWsUser.html" title="Interface that provides differents methods for accessing the FsTree as well as other features...">WsUser</a> is only calling the methods of this object.</p>
<p>If the daemon is used, <a class="el" href="classWsFsDaemonClient.html" title="Interface between the User class and the fsdaemon. ">WsFsDaemonClient</a> is used and will send and receive requests to/from the <a class="el" href="classWsFsDaemon.html" title="Main class of the FsDaemon. ">WsFsDaemon</a>.</p>
<p>Depending on the request it will use a technique to serialize and deserialize the request (see <a class="el" href="classWsTreeDeserializer.html" title="Deserializes a tree serialized with WsTreeSerializer. ">WsTreeDeserializer</a> and <a class="el" href="classWsTreeSerializer.html" title="Serializes a tree (WsAccessTree, WsMenuTree). ">WsTreeSerializer</a>)</p>
<p>The data is sent in Json format between the client and the daemon. The data is compressed if compression is enabled (see enable_compression) in the configuration file</p>
<p>If the daemon is not used, the <a class="el" href="classWsFsTreeClient.html" title="Interface between WsUser class and local tree. ">WsFsTreeClient</a> will act directly on the <a class="el" href="classWsFileSystemTree.html" title="Represents the file structure on disk. ">WsFileSystemTree</a></p>
<h2>Future</h2>
<h3>Internationalization(i18n)</h3>
<p>These are the plans for supporting internationalisation. When Internationalization is turned off, all documents published are considered to be in the default language.</p>
<p>When internationalization is turned on, the default language setting becomes mandatory. Also mandatory is the list of locales that are served to visitors. All documents that are unconfigured regarding i18n are considered to be in the default language.</p>
<p>To create a translation of an existing document, or to create a new document in a language other than the default one, the user has to use the admin interface.</p>
<p>The i18n configuration for a file is located in the file's config. Each content file can have a config file with the same name located in the .config directory. The i18n configuration directives are:</p>
<ul>
<li>id: all documents that are translations of the same content have the same id</li>
<li>locale: locale of the document in the format language or language_territory, for example en or en_US</li>
</ul>
<p>The language of the document requested by the user is the first part of the path in the URL. For example: /nl_BE/bedrijven/presentatie.html</p>
<p>When this request is received, the language is first extracted: lang = nl_BE then the path is passed to eat_path: node = eat_path("/bedrijven/presentatie.html", "nl_BE");</p>
<p>Let's say the content was first published in english, and the default language is set to english. We have this directory structure:</p>
<p>-companies +-.config +-properties +-presentation.html.json +-presentatie.html.json +-presentation.html +-__sd_presentation.html +-__ld_presentation.html +-presentatie.html +-__sd_presentatie.fhtml +-__ld_presentatie.fhtml</p>
<p>The i18n content of properties is: nl_BE : title: bedrijven this tells us that the name of the directory "companies" in the locale nl_BE is "bedrijven".</p>
<p>When the directory structure is crawled, all this info is put in the nodes. I18n information stored in the nodes gives the name of the node in other languages. So in the node for the directory companies, we have the info: nl_BE: bedrijven</p>
<p>The node needs to provide the method getChildByName that can be called to get the child handling i18n: root.getChildByName("bedrijven", "nl_BE")</p>
<p>and then get to the file node: dir_node.getChildByName("presentatie.html", "nl_BE")</p>
<p>once we have the node, we have access to its description in the language: node.getShortDescription("nl_BE") node.getLongDescription("nl_BE")</p>
<p>The short and long descriptions of each file is put in the same directory with the following naming convention:</p>
<ul>
<li>start with a double undescore: __</li>
<li>put the type of description it contains: sd for short, ld for long description</li>
<li>follow by an _</li>
<li>follow by the content filename without filename</li>
<li>give the .fhtml extension so it is identified as an html fragment and is indexed by the search engine.</li>
</ul>
<p>A request for /companies/presentation.html would also be routed correctly: if no locale is present in the URL, we use the default language. For search engine friendlyness (no duplicate content), we should redirect /en_US/companies/presentation.html to /companies/presentation.html with a 301 status.</p>
<p>Questions/remarks:</p>
<ul>
<li>at the first request, when we detect the prefered locales of the browser, we should set in the session to the nearest locale that is served by the system</li>
<li>the admin should have access to documents in locales that are not configured as being served. So he can test the site in a locale not yet available. (see below for proposed solution)</li>
<li>how do we exclude from search index the content in a locale not yet served? This seems to make mandatory an environment dedicated to edition of content when the indexer does not run. The indexer would only run in the production environment where all documents present are to be served. However, this complicates the transfer of files from the edition env to the production env as files in not published locales should be excluded from the sync. I don't think that's possible. A possibly better solution is to add a check in Node.isAuthorized and return false if the language requested is not made available. that would put all content files on the prod server, but prevent the consultation by visitors and the presence of these documents in the search results.</li>
<li>we should also limit search to the current language, and possibly enable search in all languages</li>
<li>the archive of a directory should only contain content of the language served</li>
</ul>
<h3>Git Integration</h3>
<p>TODO </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Dec 2 2013 16:33:49 for WittyShare by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.5
</small></address>
</body>
</html>
